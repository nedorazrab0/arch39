#!/usr/bin/env bash
#
# ffmpeg alias
set -e

usage() {
  echo "usage: ${0##*/} [-h] [-i FILE] [-o FILE] [-f FORMAT] [-O OPTIONS]"
  echo
  echo 'ffmpeg alias'
  echo
  echo 'options:'
  echo '  -h          show this help message and exit'
  echo '  -i FILE     specify input file'
  echo '  -o FILE     specify output file'
  echo '  -f FORMAT   specify output format'
  echo '  -O OPTIONS  specify ffmpeg options'

  exit "${1}"
}

main() {
  local OPTARG
  local arg

  # Parse args
  ((${#} == 0)) && usage 1 >&2
  while getopts 'hi:o:f:O:' arg; do
    case "${arg}" in
      i) local input="${OPTARG}" ;;
      o) local output="${OPTARG}" ;;
      f) local format="${OPTARG}" ;;
      O) local ffoptions="${OPTARG}" ;;
      h) usage 0 ;;
      *) usage 1 >&2 ;;
    esac
  done

  # https://docs.flatpak.org/en/latest/flatpak-command-reference.html
  flatpak run --command=ffmpeg --file-forwarding -- org.freedesktop.Platform \
    -hide_banner -i @@ "${input}" @@ ${ffoptions} -f "${format}" -- - \
    > "${output}"
}

main "${@}"
