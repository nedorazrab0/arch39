#!/usr/bin/env bash
#
# ffmpeg alias
set -e

usage() {
  echo "usage: ${0##*/} [-h] [-i FILE] [-o FILE] [-f FORMAT]  [-I OPTIONS]"
  echo '  [-O OPTIONS]'
  echo
  echo 'ffmpeg alias'
  echo
  echo 'options:'
  echo '  -h          show this help message and exit'
  echo '  -i FILE     specify input file'
  echo '  -o FILE     specify output file'
  echo '  -f FORMAT   specify output format'
  echo '  -I OPTIONS  specify input options'
  echo '  -O OPTIONS  specify output options'

  exit "${1}"
}

main() {
  local OPTARG
  local arg

  # Parse args
  ((${#} == 0)) && usage 1 >&2
  while getopts 'hi:o:f:I:O:' arg; do
    case "${arg}" in
      i) local input="${OPTARG}" ;;
      o) local output="${OPTARG}" ;;
      f) local format="${OPTARG}" ;;
      I) local in_opts="${OPTARG}" ;;
      O) local out_opts="${OPTARG}" ;;
      h) usage 0 ;;
      *) usage 1 >&2 ;;
    esac
  done

  # https://docs.flatpak.org/en/latest/flatpak-command-reference.html
  flatpak run --command=ffmpeg --file-forwarding -- org.freedesktop.Platform \
    -hide_banner ${in_opts} -i @@ "${input}" @@ ${out_opts} -f "${format}" \
    -- - > "${output}"
}

main "${@}"
